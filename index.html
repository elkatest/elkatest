<html>
  <head>
    <title>Elkatest by elkatest</title>
  </head>
  <body>
    <script>
var timerDelay              = 5000;
var processingBuffer  = 2000;

var redirect = function(url) {
   log('ts: ' + timestamp + '; redirecting to: ' + url);
  window.location = url;
}
var isPageHidden = function() {
    var browserSpecificProps = {hidden:1, mozHidden:1, msHidden:1, webkitHidden:1};
    for (var p in browserSpecificProps) {
        if(typeof document[p] !== "undefined"){
        return document[p];
      }
    }
    return false; // actually inconclusive, assuming not
}
var elapsedMoreTimeThanTimerSet = function(){
    var elapsed = new Date().getTime() - timestamp;
  log('elapsed: ' + elapsed);
  return timerDelay + processingBuffer < elapsed;
}
var redirectToFallbackIfBrowserStillActive = function() {
  var elapsedMore = elapsedMoreTimeThanTimerSet();
  log('hidden:' + isPageHidden() +'; time: '+ elapsedMore);
  if (isPageHidden() || elapsedMore) {
    log('not redirecting');
  }else{
    redirect('itms-apps://itunes.apple.com/ru/app/moj-rostelekom/id561082205?mt=8');
  }
}
var log = function(msg){
    document.getElementById('log').innerHTML += msg + "<br>";
}

setTimeout(redirectToFallbackIfBrowserStillActive, timerDelay);
redirect('rt://');    
      </script>
 <div id="log">Testing Elka redirects</div>
      <p>itms-apps://itunes.apple.com/ru/app/moj-rostelekom/id561082205?mt=8</p>
        meta name="apple-itunes-app" content="app-id=561082205, app-argument=myURL">
    meta http-equiv="refresh" content="0; url=itms-apps://itunes.apple.com/ru/app/moj-rostelekom/id561082205?mt=8" />    
      
  </body>
</html>
